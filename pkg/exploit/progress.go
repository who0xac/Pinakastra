package exploit

import (
	"fmt"
	"sync"
)

// ProgressTracker tracks test progress for live terminal updates
type ProgressTracker struct {
	testName    string
	totalTests  int
	currentTest int
	payload     string
	mu          sync.Mutex
}

// ProgressUpdate represents a real-time progress update
type ProgressUpdate struct {
	Type        string // "start", "payload", "found", "complete", "error"
	TestName    string
	Payload     string
	CurrentTest int
	TotalTests  int
	Message     string
}

// sendProgressUpdate sends a progress update through the channel
func sendProgressUpdate(progressChan chan<- string, updateType, testName, payload string, current, total int) {
	if progressChan == nil {
		return
	}

	var msg string
	switch updateType {
	case "start":
		msg = fmt.Sprintf("start:%s:%d", testName, total)
	case "payload":
		msg = fmt.Sprintf("payload:%s:%s:%d:%d", testName, payload, current, total)
	case "found":
		msg = fmt.Sprintf("found:%s", testName)
	case "complete":
		msg = fmt.Sprintf("complete:%s:%d", testName, total)
	case "error":
		msg = fmt.Sprintf("error:%s:%s", testName, payload)
	}

	progressChan <- msg
}
